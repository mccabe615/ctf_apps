(function(a){function r(a,b){return a=typeof a,b?a==b:a!="undefined"}function s(a,b,c){var d;if(!a)return 0;c=c?c:a;if(r(a.length)){for(d=0;d<a.length;d++)if(b.call(c,a[d],d,a)===!1)return 0}else for(d in a)if(a.hasOwnProperty(d)&&b.call(c,a[d],d,a)===!1)return 0;return 1}function t(a,b){return s(b,function(b,c){a[c]=b}),a}var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;q=navigator.userAgent,a.isOpera=n=window.opera&&opera.buildNumber,a.isWebKit=o=/WebKit/.test(q),a.isOldWebKit=p=o&&!window.getSelection().getRangeAt,a.isIE=l=!o&&!n&&/MSIE/gi.test(q)&&/Explorer/gi.test(navigator.appName),a.isGecko=m=!o&&/Gecko/.test(q),a.plugins={},t(a,{is:r,each:s,extend:t}),a.I18n=j={bold:"Bold (Ctrl+B)",italic:"Italic (Ctrl+I)",underline:"Underline (Ctrl+U)",strike:"Striketrough",ul:"Insert unordered list",ol:"Insert ordered list",indent:"Indent",outdent:"Outdent",left:"Align left",center:"Align center",right:"Align right",style:"Font style",removeformat:"Remove format",increasefontsize:"Increase text size",decreasefontsize:"Decrease text size"},a.DOMUtils=b=function(b){this.files=[];try{b.execCommand("BackgroundImageCache",0,1)}catch(c){}t(this,{get:function(a){return a&&(!a.nodeType&&!a.location?b.getElementById(a):a)},add:function(a,c,d,e){var f=this,g;return g=b.createElement(c),s(d,function(a,b){f.setAttr(g,b,a)}),e&&(e.nodeType?g.appendChild(e):g.innerHTML=e),a?a.appendChild(g):g},create:function(a,b,c){return this.add(0,a,b,c)},setAttr:function(a,b,c){return a=this.get(a),a?(b=="style"&&(a.setAttribute("mce_style",c),a.style.cssText=c),b=="class"&&(a.className=c),c!=null&&c!=""?a.setAttribute(b,""+c):a.removeAttribute(b),1):0},getAttr:function(a,b,c){var d;a=this.get(a);if(!a)return!1;r(c)||(c="");if(/^(src|href|style)$/.test(b)){d=this.getAttr(a,"mce_"+b);if(d)return d}return d=a.getAttribute(b,2),b=="class"&&!d&&(d=a.className),b=="style"&&!d?d=a.style.cssText:d||(d=a.attributes[b],d=d&&r(d.nodeValue)?d.nodeValue:d),o&&b=="class"&&d&&(d=d.replace(/(apple|webkit)\-[a-z\-]+/gi,"")),d&&d!=""?""+d:c},select:function(a,c,d){var e=[];return c=this.get(c),c=c?c:b,s(a.split(","),function(a){s(c.getElementsByTagName(a),function(a){(!d||d(a))&&e.push(a)})}),e},getPos:function(b,c){var d=0,e=0,f,g,h;b=this.get(b);if(a.isIE&&b)return g=b.getBoundingClientRect(),h=document,b=h.compatMode=="CSS1Compat"?h.documentElement:h.body,{x:g.left+(b.scrollLeft||0),y:g.top+(b.scrollTop||0)};while(b&&b!=c)d+=b.offsetLeft||0,e+=b.offsetTop||0,b=b.offsetParent;return{x:d,y:e}},loadCSS:function(a){var c=this;a&&s(a.split(","),function(a){var d=-1;s(c.files,function(b,c){if(b==a)return d=c,!1});if(d!=-1)return;c.files.push(a),b.createStyleSheet?b.createStyleSheet(a):c.add(c.select("head")[0],"link",{rel:"stylesheet",href:a})})},addClass:function(a,b,c){var d;return a=this.get(a),a?(d=this.removeClass(a,b),a.className=c?b+(d!=""?" "+d:""):(d!=""?d+" ":"")+b):0},removeClass:function(a,b){return a=this.get(a),a?(b=a.className.replace(new RegExp("(^|\\s+)"+b+"(\\s+|$)","g")," "),a.className=b!=" "?b:""):0},hasClass:function(a,b){return a=this.get(a),(new RegExp("\\b"+b+"\\b","g")).test(a.className)},getParent:function(a,b,c){while(a){if(a==c)return null;if(b(a))return a;a=a.parentNode}return null},keep:function(a){return m&&(a=a.replace(/<(\/?)strong>|<strong( [^>]+)>/gi,"<$1b$2>"),a=a.replace(/<(\/?)em>|<em( [^>]+)>/gi,"<$1i$2>"),a=a.replace(/<(\/?)del|<del( [^>]+)>/gi,"<$1strike$2>")),a=a.replace(/ (src|href|style)=\"([^\"]+)\"/gi,' $1="$2" mce_$1="$2"'),a}})},a.DOM=k=new b(document),a.Event=h={events:[],inits:[],unloads:[],add:function(a,b,c,d){var e,f=this,g=f.events;return a=k.get(a),e=function(a){return a=a||window.event,a&&!a.target&&l&&(a.target=a.srcElement),d?c.call(d,a):c(a)},b=="unload"?(f.unloads.push(e),e):b=="init"?(f._init?e():f.inits.push(e),e):(g.push({obj:a,name:b,func:c,cfunc:e,scope:d}),f._add(a,b,e),l&&g.length==1&&h._add(window,"unload",f._unload,h),e)},remove:function(a,b,c){var d=this,e=d.events;a=k.get(a),s(e,function(f,g){if(f.obj==a&&f.name==b&&(!c||f.func==c))return e.splice(g,1),d._remove(a,b,f.cfunc),!1})},cancel:function(a){return this.stop(a),this.prevent(a)},stop:function(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,!1},prevent:function(a){return a.preventDefault?a.preventDefault():a.returnValue=!1,!1},_unload:function(){var a=h;s(a.events,function(b){a._remove(b.obj,b.name,b.cfunc)}),a._remove(window,"unload",a._unload),a.events=[],s(a.unloads,function(a){a()})},_add:function(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener?a.addEventListener(b,c,!1):a["on"+b]=c},_remove:function(a,b,c){a.detachEvent?a.detachEvent("on"+b,c):a.removeEventListener?a.removeEventListener(b,c,!1):a["on"+b]=null},_pageInit:function(){var a=h;a._remove(window,"DOMContentLoaded",a._pageInit),a._init=!0,s(a.inits,function(a){a()}),a.inits=[]},_wait:function(){var a;if(l&&document.location.protocol!="https:")document.write("<script id=__ie_onload defer src=javascript:void(0)></script>"),k.get("__ie_onload").onreadystatechange=function(){this.readyState=="complete"&&(h._pageInit(),k.get("__ie_onload").onreadystatechange=null)};else{h._add(window,"DOMContentLoaded",h._pageInit,h);if(l||o)a=setInterval(function(){/loaded|complete/.test(document.readyState)&&(clearInterval(a),h._pageInit())},10)}}},a.Dispatcher=g=function(a){var b=[];a||(a=this),t(this,{add:function(c,d){return b.push({cb:c,scope:d?d:a}),c},remove:function(a){return s(b,function(c,d){return a==c.cb&&b.splice(d,1),!1}),a},dispatch:function(){var a,c=arguments;return s(b,function(b){return a=b.cb.apply(b.scope,c)}),a}})},a.Editor=e=function(c){function q(a){var b,c,e,f;b=k.get(d.id+"_c"),e=b.clientWidth-2,f=b.clientHeight-2,c=k.get(d.id+"_p"),c.style.width=e+"px",c.style.height=f+"px",b.style.display="none",c.style.display="block",p.resize={x:a.screenX,y:a.screenY,w:e,h:f},h.add(document,"mousemove",u,this),h.add(document,"mouseup",v,this),p.onResizeStart.dispatch(p,a,e,f)}function u(a){var b=p.resize,c,e,f;return b.dx=a.screenX-b.x,b.dy=a.screenY-b.y,e=Math.max(d.min_width,b.w+b.dx),f=Math.max(d.min_height,b.h+b.dy),e=Math.min(d.max_width,e),f=Math.min(d.max_height,f),c=k.get(d.id+"_p"),c.style.width=e+"px",c.style.height=f+"px",h.cancel(a)}function v(a){var b=p.resize;h.remove(document,"mousemove",u,this),h.remove(document,"mouseup",v,this),k.get(d.id+"_c").style.display="",k.get(d.id+"_p").style.display="none",p.resizeBy(b.dx,b.dy),p.onResizeEnd.dispatch(p,a,b.dx,b.dy)}function x(){var c=k.get(d.id),f=p.getDoc();m&&(p.getDoc().designMode="On"),f.open(),f.write('<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /></head><body id="punymce"></body></html>'),f.close(),p.dom=e=new b(p.getDoc()),e.loadCSS(d.content_css),p.onPreInit.dispatch(p),d.spellcheck||(p.getBody().spellcheck=0),h.add(p.getDoc(),"mouseup",p.nodeChanged,p),h.add(p.getDoc(),"keyup",p.nodeChanged,p),h.add(m?p.getDoc():p.getWin(),"focus",function(b){var c;(c=a.focusEditor)!=null&&c.onBlur.dispatch(c,p),p.onFocus.dispatch(p,c),a.focusEditor=p},this),l?p.getBody().contentEditable=!0:p.getDoc().designMode="On",p.setContent(r(c.value)?c.value:c.innerHTML,{load:!0}),k.get(d.id+"_c").style.display=p.orgDisplay,k.get(d.id).style.display="none",p.onInit.dispatch(p)}var d,e,p=this;a.baseURL||s(k.select("script"),function(b){/puny_mce/g.test(""+b.src)&&(a.baseURL=b.src.replace(/^(.+)\/puny_mce.+$/,"$1/"))}),this.settings=d=t({content_css:a.baseURL+"css/content.css",editor_css:a.baseURL+"css/editor.css",blank_file:a.baseURL+"blank.html",width:0,height:0,min_width:260,min_height:50,max_width:800,max_height:600,entities:"raw",spellcheck:0,resize:!0,plugins:"",styles:[{title:"H1",cls:"h1",cmd:"FormatBlock",val:"<h1>"},{title:"H2",cls:"h2",cmd:"FormatBlock",val:"<h2>"},{title:"H3",cls:"h3",cmd:"FormatBlock",val:"<h3>"},{title:"Pre",cls:"pre",cmd:"FormatBlock",val:"<pre>"},{title:"Times",cls:"times",cmd:"FontName",val:"Times"},{title:"Arial",cls:"arial",cmd:"FontName",val:"Arial"},{title:"Courier",cls:"courier",cmd:"FontName",val:"Courier"}],toolbar:"bold,italic,underline,strike,increasefontsize,decreasefontsize,ul,ol,indent,outdent,left,center,right,style,removeformat"},c),p.tools={bold:{cmd:"Bold",title:j.bold},italic:{cmd:"Italic",title:j.italic},underline:{cmd:"Underline",title:j.underline},strike:{cmd:"Strikethrough",title:j.strike},ul:{cmd:"InsertUnorderedList",title:j.ul},ol:{cmd:"InsertOrderedList",title:j.ol},indent:{cmd:"Indent",title:j.indent},outdent:{cmd:"Outdent",title:j.outdent},left:{cmd:"JustifyLeft",title:j.left},center:{cmd:"JustifyCenter",title:j.center},right:{cmd:"JustifyRight",title:j.right},style:{cmd:"mceStyle",title:j.style},removeformat:{cmd:"RemoveFormat",title:j.removeformat},increasefontsize:{cmd:"IncreaseFontSize",title:j.increasefontsize},decreasefontsize:{cmd:"DecreaseFontSize",title:j.decreasefontsize}},k.loadCSS(d.editor_css),this.commands={mceStyle:function(a,b,c){function l(a){e.hideMenu=null,h.remove(document,"click",l),h.remove(e.getDoc(),"click",l),k.get(g+"_mstyle").style.display="none"}var d,e=this,f=e.settings,g=f.id,i=k.getPos(c.target),j;if(e.hideMenu)return e.hideMenu();d=k.get(g+"_mstyle"),d||(d=k.get(g+"_t"),d=k.add(document.body,"div",{id:g+"_mstyle","class":"punymce_style punymce"}),s(f.styles,function(a){h.add(k.add(d,"a",{href:"#","class":a.cls},a.title),"mousedown",function(b){return l.call(e),e.execCommand(a.cmd,a.ui,a.val),n&&e.getIfr().focus(),h.cancel(b)})})),e.hideMenu=l,h.add(document,"click",l,e),h.add(e.getDoc(),"click",l,e),f=d.style,f.left=i.x+"px",f.top=i.y+c.target.clientHeight+2+"px",f.display="block"},FormatBlock:function(a,b,c){m&&/<(div|blockquote|code|dt|dd|dl|samp)>/gi.test(b)&&(b=b.replace(/[^a-z]/gi,"")),p.getDoc().execCommand("FormatBlock",0,b)},CreateLink:function(a,b){var c=p.dom,d="javascript:mox();";p.getDoc().execCommand("CreateLink",0,d),s(c.select("A"),function(a){c.getAttr(a,"href")==d&&(c.setAttr(a,"href",b),c.setAttr(a,"mce_href",b))})},mceFontSizeDelta:function(a,b){var c=p.getDoc(),d,e,f,g=p.selection;d=parseInt(c.queryCommandValue("FontSize")||3),o&&s([10,13,16,18,24,32,48],function(a,b){if(d==a)return d=b+1,!1});if(d+b<=1)return;c.execCommand("FontSize",!1,d+b)},IncreaseFontSize:function(){p.execCommand("mceFontSizeDelta",0,1)},DecreaseFontSize:function(){p.execCommand("mceFontSizeDelta",0,-1)},Indent:function(a,b,c){p.getDoc().execCommand("Indent",0,0),l&&p.dom.getParent(p.selection.getNode(),function(a){a.nodeName=="BLOCKQUOTE"&&(a.dir=a.style.marginRight="")})},mceSetClass:function(a,b,c){var d=p.selection;r(b,"string")&&(b={element:"span","class":b}),d.isCollapsed()?p.dom.setAttr(d.getNode(),"class",b["class"]):d.setContent("<"+b.element+' class="'+b["class"]+'">'+d.getContent()+"</"+b.element+">")},RemoveFormat:function(a,b,c){var d=p.selection;p.getDoc().execCommand("RemoveFormat",a,b),l&&(b=d.getContent(),b=b.replace(/ (class|style)=\"[^\"]+\"/g,""),b=b.replace(/<\/?(font|strong|em|b|i|u|strike)>/g,""),b=b.replace(/<(font|strong|em|b|i|u|strike) [^>]+>/g,""),d.setContent(b))}},t(this,{serializer:new i(p),selection:new f(p),plugins:[]}),s(["onPreInit","onInit","onFocus","onBlur","onResizeStart","onResizeEnd","onPreProcess","onPostProcess","onSetContent","onBeforeGetContent","onGetContent","onNodeChange"],function(a){p[a]=new g(p)}),t(this,{init:function(){var b=k.get(d.id),c=b.parentNode,e,f,g,i,j,l,m,n=["bold","italic","underline","left","center","right"];s(d.plugins.split(","),function(b){b&&p.plugins.push(new a.plugins[b](p))}),p.onNodeChange.add(function(){s(n,function(a){var b;try{b=p.getDoc().queryCommandState(p.tools[a].cmd)?k.addClass:k.removeClass,b.call(k,d.id+"_"+a,"active")}catch(c){}})}),d.entities=="numeric"&&p.onGetContent.add(function(a,b){b.format=="html"&&(b.content=b.content.replace(/[\u007E-\uFFFF]/g,function(a){return"&#"+a.charCodeAt(0)+";"}))}),e=d.width?d.width:b.offsetWidth,f=d.height?d.height:b.offsetHeight,p.orgDisplay=b.style.display,b.style.display="none",b.form&&(m=b.form,p._submit=m.submit,m.submit=function(){var a=k.get(d.id),b=a.form;p.save(),b.submit=p._submit,b.submit()},h.add(0,"unload",function(){var a=k.get(d.id).form;p._submit=p.submit=null}),h.add(m,"submit",p.save,p)),g='<div id="'+d.id+'_w" class="punymce"><table id="'+d.id+'_c" class="punymce"><tr class="mceToolbar">',g+='<td id="'+d.id+'_t"></td></tr><tr class="mceBody"><td></div><div id="'+d.id+'_b" class="mceBody">',d.resize&&(g+='<div id="'+d.id+'_r" class="mceResize"></div>'),g+="</td></tr></table>",g+='<div id="'+d.id+'_p" class="mcePlaceholder"></div></div>',b.insertAdjacentHTML?b.insertAdjacentHTML("beforeBegin",g):(l=b.ownerDocument.createRange(),l.setStartBefore(b),c.insertBefore(l.createContextualFragment(g),b)),j=k.get(d.id+"_t"),i=k.add(j,"ul",{id:d.id+"_tb","class":"punymce"}),s(d.toolbar.split(","),function(a){var b=p.tools[a];j=k.add(k.add(i,"li",{id:d.id+"_"+a,"class":a}),"a",{href:"javascript:void(0);","class":a,title:b.title,tabIndex:-1,onmousedown:"return false;"}),h.add(j,"click",function(a){return k.hasClass(a.target.parentNode,"disabled")||p.execCommand(b.cmd,0,0,a),h.cancel(a)})}),j=k.get(d.id+"_b"),j=k.add(j,"iframe",{id:d.id+"_f",src:'javascript:""',frameBorder:"0","class":"punymce",style:"width:"+e+"px;height:"+f+"px"}),p.resizeTo(e,f),o?(h.add(j,"load",x,p),j.src=d.blank_file):x(),d.resize&&h.add(d.id+"_r","mousedown",function(a){return q(a,d.id)},this),i=m=b=j=null},getSize:function(){var a=k.get(d.id+"_f");return{w:a.clientWidth,h:a.clientHeight}},resizeTo:function(a,b){var c=k.get(d.id+"_f").style;a=Math.max(d.min_width,a),b=Math.max(d.min_height,b),a=Math.min(d.max_width,a),b=Math.min(d.max_height,b),p.width=a,p.height=b,c.width=a+"px",c.height=b+"px"},resizeBy:function(a,b){var c=p.getSize();p.resizeTo(c.w+a,c.h+b)},show:function(){k.get(d.id+"_w").style.display="block",k.get(d.id).style.display="none",p.load()},hide:function(){l&&p.execCommand("SelectAll"),k.get(d.id+"_w").style.display="none",k.get(d.id).style.display=p.orgDisplay,p.save()},load:function(){var a=k.get(d.id);p.setContent(r(a.value)?a.value:a.innerHTML,{load:!0})},save:function(){var a=k.get(d.id),b=p.getContent({save:!0});b=b.replace(/<(\/?)html(\/?)>/gi,""),/TEXTAREA|INPUT/.test(a.nodeName)?a.value=b:a.innerHTML=b},setUseCSS:function(a){var b=p.getDoc(),c;try{b.execCommand("styleWithCSS",0,!1)}catch(c){try{b.execCommand("useCSS",0,!0)}catch(c){}}},execCommand:function(a,b,c,d){var e=p.commands,f;p.getWin().focus(),p.setUseCSS(0),e[a]?f=e[a].call(p,b,c,d):f=p.getDoc().execCommand(a,b,c),f!==!1&&p.nodeChanged()},getContent:function(a){var b;return a=a||{},a.format=a.format||"html",p.onBeforeGetContent.dispatch(this,a),b=p.serializer.serialize(p.getBody(),a),b=b.replace(/^\s*|\s*$/g,""),a.content=b,p.onGetContent.dispatch(this,a),a.content},setContent:function(a,b){return b=b||{},b.content=a,p.onSetContent.dispatch(this,b),a=b.content,a=k.keep(a),p.getBody().innerHTML=a,b.format!="raw"?p.setContent(a=p.getContent(b),{format:"raw"}):p.getBody().innerHTML=a,a},getIfr:function(){return k.get(d.id+"_f")},getWin:function(){return p.getIfr().contentWindow},getDoc:function(){return p.getWin().document},getBody:function(){return p.getDoc().body},nodeChanged:function(){p.setUseCSS(0),p.onNodeChange.dispatch(p,p.selection.getNode())}}),h.add(window,"init",p.init,this)},a.Selection=f=function(a){var b=this;t(b,{getContent:function(c){var d,e=b.getRng(),f=document.createElement("body");return c=c||{},b.isCollapsed()?"":(e.cloneContents?f.appendChild(e.cloneContents()):r(e.item)||r(e.htmlText)?f.innerHTML=e.item?e.item(0).outerHTML:e.htmlText:f.innerHTML=e.toString(),c.format!="raw"?(c.content=d,a.serializer.serialize(f,c),c.content=c.content.replace(/^\s*|\s*$/g,""),a.onGetContent.dispatch(d,c),d=c.content):d=f.innerHTML,d)},getText:function(){var a=b.getRng(),c=b.getSel();return p?c:b.isCollapsed()?"":a.text||c.toString()},setContent:function(c,d){var e=b.getRng(),f,g,e,h;d=d||{format:"raw"},c=k.keep(c),d.format!="raw"&&(d.content=c,c=a.onSetContent.dispatch(this,d),c=d.content,f=a.dom.create("body"),f.innerHTML=c),e.insertNode?(e.deleteContents(),e.insertNode(e.createContextualFragment(c+'<span id="__caret">_</span>')),g=a.dom.get("__caret"),e=a.getDoc().createRange(),e.setStartBefore(g),e.setEndBefore(g),h=b.getSel(),h.removeAllRanges(),h.addRange(e),g.parentNode.removeChild(g)):e.pasteHTML?e.pasteHTML(c):e.item(0).outerHTML=c},select:function(a,c){var d=b.getRng(),e=b.getSel();if(d.moveToElementText)try{d.moveToElementText(a),d.select()}catch(f){}else e.addRange?(c?d.selectNodeContents(a):d.selectNode(a),e.removeAllRanges(),e.addRange(d)):e.setBaseAndExtent(a,0,a,1);return a},isCollapsed:function(){var a=b.getRng();return a.item?!1:a.boundingWidth==0||b.getSel().isCollapsed},collapse:function(a){var c=b.getRng(),d=b.getSel();c.select?(c.collapse(a),c.select()):a?d.collapseToStart():d.collapseToEnd()},getSel:function(){var b=a.getWin();return b.getSelection?b.getSelection():a.getDoc().selection},getRng:function(){var c=b.getSel(),d=a.getDoc(),e,f,g,h;if(!c)return null;try{return c.rangeCount>0?c.getRangeAt(0):c.createRange?c.createRange():null}catch(i){return d.body.createTextRange()}},setRng:function(a){var c=b.getSel();c.removeAllRanges(),c.addRange(a)},setNode:function(c){b.setContent(a.dom.create("div",null,c).innerHTML)},getNode:function(){var a=b.getRng(),c=b.getSel(),d;return l?a.item?a.item(0):a.parentElement():(a&&(d=a.commonAncestorContainer,a.collapsed||a.startContainer==a.endContainer&&a.startOffset-a.endOffset<2&&a.startContainer.hasChildNodes()&&(d=a.startContainer.childNodes[a.startOffset])),k.getParent(d,function(a){return a.nodeType==1}))}})},a.Serializer=i=function(a){function e(){var a=document.implementation;if(!!a&&!!a.createDocument)return a.createDocument("","",null);try{return new ActiveXObject("MSXML2.DOMDocument")}catch(b){}try{return new ActiveXObject("Microsoft.XmlDom")}catch(b){}}function f(a){var b=[];return a.cloneNode(!1).outerHTML.replace(/([a-z0-9\-_]+)=/gi,function(a,c){b.push({specified:1,nodeName:c})}),b}function g(a,e){var h,i,j,m,n,o,p,q,r;if((!d.valid_nodes||d.valid_nodes.test(a.nodeName))&&(!d.invalid_nodes||!d.invalid_nodes.test(a.nodeName))&&(!d.node_filter||d.node_filter(a,e)))switch(a.nodeType){case 1:if(l){if(a.mce_serialized==c)return;a.mce_serialized=c}h=a.hasChildNodes(),i=b.createElement(a.nodeName.toLowerCase()),p=l?f(a):a.attributes;for(m=p.length-1;m>-1;m--){q=p[m];if(q.specified){o=q.nodeName.toLowerCase();if(d.invalid_attrs&&d.invalid_attrs.test(o))continue;if(d.valid_attrs&&!d.valid_attrs.test(o))continue;r=k.getAttr(a,o),r!==""&&i.setAttribute(o,r)}}!h&&!d.closed.test(a.nodeName)&&i.appendChild(b.createTextNode("")),e=e.appendChild(i);break;case 3:return e.appendChild(b.createTextNode(a.nodeValue));case 8:return e.appendChild(b.createComment(a.nodeValue))}else a.nodeType==1&&(h=a.hasChildNodes());if(h){j=a.firstChild;while(j)g(j,e),j=j.nextSibling}}var b,c=0,d;b=e(),this.settings=d=t({valid_nodes:0,invalid_nodes:/(BODY)/,valid_attrs:0,node_filter:0,root_node:0,pi:0,invalid_attrs:/(^mce_|^_moz_|^contenteditable$)/,closed:/(BR|HR|INPUT|META|IMG)/},a.settings.serializer),t(this,{serialize:function(e,f){var h;return c=""+(parseInt(c)+1),b.firstChild&&b.removeChild(b.firstChild),e=f.node=e.cloneNode(1),a.onPreProcess.dispatch(this,f),g(e,b.appendChild(b.createElement("html"))),h=b.xml||(new XMLSerializer).serializeToString(b),d.pi||(h=h.replace(/<\?[^?]+\?>/g,"")),d.root_node||(h=h.replace(/<html>|<\/html>/g,"")),f.content=h,a.onPostProcess.dispatch(this,f),f.content}})},h._wait(),window.punymce=a})({}),function(a){a.plugins.BBCode=function(b){b.onGetContent.add(function(b,c){(c.format=="bbcode"||c.save)&&a.each([[/<a href=\"(.*?)\".*?>(.*?)<\/a>/gi,"[url=$1]$2[/url]"],[/<font.*?color=\"([^\"]+)\".*?>(.*?)<\/font>/gi,"[color=$1]$2[/color]"],[/<img.*?src=\"([^\"]+)\".*?\/>/gi,"[img]$1[/img]"],[/<(br\s*\/)>/gi,"\n"],[/<(\/?)(strong|b)[^>]*>/gi,"[$1b]"],[/<(\/?)(em|i)[^>]*>/gi,"[$1i]"],[/<(\/?)u[^>]*>/gi,"[$1u]"],[/<(\/?)(code|pre)[^>]*>/gi,"[$1code]"],[/<(\/?)(span.*?class=\"quote\")[^>]*>(.*?)<\/span>/gi,"[$1quote]$3[/quote]"],[/<p>/gi,""],[/<\/p>/gi,"\n"],[/&quot;/gi,'"'],[/&lt;/gi,"<"],[/&gt;/gi,">"],[/&amp;/gi,"&"],[/<[^>]+>/gi,""]],function(a){c.content=c.content.replace(a[0],a[1])})}),b.onSetContent.add(function(b,c){(c.format=="bbcode"||c.load)&&a.each([[/\n/gi,"<br />"],[/\[(\/?)b\]/gi,"<$1strong>"],[/\[(\/?)i\]/gi,"<$1em>"],[/\[(\/?)u\]/gi,"<$1u>"],[/\[(\/?)code\]/gi,"<$1pre>"],[/\[url\](.*?)\[\/url\]/gi,'<a href="$1">$1</a>'],[/\[url=([^\]]+)\](.*?)\[\/url\]/gi,'<a href="$1">$2</a>'],[/\[img\](.*?)\[\/img\]/gi,'<img src="$1" />'],[/\[color=(.*?)\](.*?)\[\/color\]/gi,'<font color="$1">$2</font>'],[/\[quote.*?\](.*?)\[\/quote\]/gi,'<span class="quote">$1</span>']],function(a){c.content=c.content.replace(a[0],a[1])})})}}(punymce),function(a){a.plugins.EditSource=function(b){var c=a.DOM,d=a.extend,e=a.each,f=a.isWebKit,g=0;(!b.settings.editsource||b.settings.editsource.skip_css)&&c.loadCSS(a.baseURL+"/plugins/editsource/css/editor.css"),b.onBeforeGetContent.add(function(a,b){b.save&&g&&a.setContent(c.get(a.settings.id+"_editsourcearea").value,{load:!0})}),d(b.commands,{mceEditSource:function(a,d,h){var i,j=b.getIfr(),k=b.settings.id,l=b.width,m=b.height,n,o=c.get(k+"_editsource");return g?(g=0,c.removeClass(o,"active"),f||(j.style.display="block",i=c.get(k+"_edspacer"),i.parentNode.removeChild(i)),i=c.get(k+"_editsourcearea"),b.setContent(i.value,{load:!0}),i.parentNode.removeChild(i),e(c.select("li",k+"_c"),function(a){c.removeClass(a,"disabled")}),!1):(c.addClass(o,"active"),e(c.select("li",k+"_c"),function(a){a!=o&&c.addClass(a,"disabled")}),i=c.add(j.parentNode,"textarea",{id:k+"_editsourcearea","class":"editsource",style:"width:"+l+"px;height:"+m+"px;"}),i.value=b.getContent({save:!0}),i.focus(),f||(c.add(j.parentNode,"div",{id:k+"_edspacer","class":"spacer",style:"width:"+l+"px;height:"+m+"px;"}),j.style.display="none"),g=1,!1)}}),d(b.tools,{editsource:{cmd:"mceEditSource",title:a.I18n.editsource}})},a.extend(a.I18n,{editsource:"Edit HTML source"})}(punymce),function(a){a.plugins.Emoticons=function(b){function l(a){var b;return d(h.emoticons,function(c,e){return d(c,function(c){if(c==a)return b=e,!1}),!b}),b}var c=a.Event,d,e,f,g,h,i,j,k;d=a.each,e=a.extend,f=a.isIE,g=a.isGecko,j=a.DOM,this.settings=h=e({emoticons:{happy:[":)","=)"],unhappy:[":|","=|"],sad:[":(","=("],grin:[":D","=D"],surprised:[":o",":O","=o","=O"],wink:[";)"],halfhappy:[":/","=/"],tounge:[":P",":p","=P","=p"],lol:[],mad:[],rolleyes:[],cool:[]},row_length:4,trans_img:a.baseURL+"plugins/emoticons/img/trans.gif",skip_css:0,auto_convert:1},b.settings.emoticons),h.skip_css||j.loadCSS(a.baseURL+"/plugins/emoticons/css/editor.css"),i="",d(h.emoticons,function(a){d(a,function(a){i.length!=0&&(i+="|"),i+=a.replace(/([^a-zA-Z0-9])/g,"\\$1")})}),i=new RegExp(i,"g"),e(b.commands,{mceEmoticons:function(a,e,f){function q(a){return b.hideMenu=null,c.remove(document,"click",q),c.remove(b.getDoc(),"click",q),j.get(k+"_memoticons").style.display="none",1}var g,i=this,k=b.settings.id,l=j.getPos(f.target),o,p;if(b.hideMenu)return b.hideMenu();g=j.get(k+"_memoticons"),g||(g=j.get(k+"_t"),g=j.add(document.body,"div",{id:k+"_memoticons","class":"punymce_emoticons punymce"}),g=j.add(g,"table",{"class":"punymce"}),g=j.add(g,"tbody"),o=h.row_length,d(h.emoticons,function(a,d){o==h.row_length&&(r=j.add(g,"tr"),o=0),o++,c.add(j.add(j.add(r,"td"),"a",{href:"#","class":"emoticon "+d}),"mousedown",function(e){return q.call(i),b.selection.setNode(b.dom.create("img",{title:a[0]||d,src:h.trans_img,"class":"emoticon "+d})),c.cancel(e)})})),c.add(document,"click",q,i),c.add(b.getDoc(),"click",q,i),b.hideMenu=q,s=j.get(k+"_memoticons").style,s.left=l.x+"px",s.top=l.y+f.target.clientHeight+2+"px",s.display="block"}}),b.onPreProcess.add(function(a,c){var e=c.node.getElementsByTagName("img"),f=[];d(e,function(a){f.push(a)}),d(f,function(a){var c=b.dom.getAttr(a,"class");c&&c.indexOf("emoticon")!=-1&&a.parentNode.replaceChild(b.getDoc().createTextNode(a.getAttribute("title")),a)})}),b.onSetContent.add(function(a,b){var c=[];k=b.content.replace(/(<\/?[^>]+>|:\/\/)/g,function(a){return a.replace(i,function(a){var b=l(a);return b?(c.push(a),"�"+c.length+"�"):a})}),k=k.replace(i,function(a){return'<img src="'+h.trans_img+'" title="'+a+'" class="emoticon '+l(a)+'" />'}),k=k.replace(/�([^�]+)�/g,function(a,b){return c[parseInt(b)-1]}),b.content=k}),b.onInit.add(function(){var d=b.dom;h.skip_css||d.loadCSS(a.baseURL+"/plugins/emoticons/css/content.css"),c.add(b.getDoc(),"controlselect",function(a){if(d.getAttr(a.target,"class").indexOf("emoticon")!=-1)return c.cancel(a)}),g&&(c.add(b.getDoc(),"mousedown",function(a){if(d.getAttr(a.target,"class").indexOf("emoticon")!=-1)return b.getDoc().execCommand("enableObjectResizing",!1,!1),c.cancel(a);b.getDoc().execCommand("enableObjectResizing",!1,!0)}),c.add(b.getDoc(),"keydown",function(a){var d=b.selection,e=d.getSel(),f=b.getDoc(),g=d.getRng(),h,i,j,k;h=g.startContainer,i=g.startOffset;if(h.nodeType==1)return;if(h){if(a.keyCode==39&&i==h.nodeValue.length){j=h.nextSibling;if(j&&j.nodeName=="IMG")return j=j.nextSibling,g=f.createRange(),g.setStart(j,0),g.setEnd(j,0),e.removeAllRanges(),e.addRange(g),c.cancel(a)}if(a.keyCode==37&&i==0){j=h.previousSibling;if(j&&j.nodeName=="IMG")return j=j.previousSibling,k=j.nodeValue.length,g=f.createRange(),g.setStart(j,k),g.setEnd(j,k),e.removeAllRanges(),e.addRange(g),c.cancel(a)}}})),c.add(b.getDoc(),"keypress",function(e){function s(a){var b,c,d;if(!!f)return r=r.duplicate(),r.moveStart("character",a),r.text;b=r.startContainer,c=r.startOffset,d=r.endOffset;if(c>0&&b.nodeType==3)return b.nodeValue.substring(Math.max(0,c+a),d)}var g,j,k,m,o=b.getDoc(),p=b.selection,q=p.getSel(),r=p.getRng();if(a.isOldWebKit||!h.auto_convert)return!0;if(/(ttp|ftp):/i.test(s(-4)))return;k=s(-1),g=k+String.fromCharCode(e.charCode||e.keyCode),i.lastIndex=0;if(!k||!i.test(g)||m=="/")return;if(j=l(g))return f?(r=b.selection.getRng(),r.moveStart("character",-1),r.select()):(r.setStart(r.startContainer,r.startOffset-1),q.removeAllRanges(),q.addRange(r)),b.selection.setNode(d.create("img",{id:"emoticon",title:g,src:h.trans_img,"class":"emoticon "+j})),g=d.get("emoticon"),d.setAttr(g,"id",""),b.selection.select(g),b.selection.collapse(0),c.cancel(e)})}),e(b.tools,{emoticons:{cmd:"mceEmoticons",title:a.I18n.emoticons}})},a.extend(a.I18n,{emoticons:"Insert emoticon"})}(punymce),function(a){a.plugins.Entities=function(a){var b,c,d="",e={},f,g,h;b=a.settings,b.entities="named",h=b.entity_list,h||(h="160,nbsp,161,iexcl,162,cent,163,pound,164,curren,165,yen,166,brvbar,167,sect,168,uml,169,copy,170,ordf,171,laquo,172,not,173,shy,174,reg,175,macr,176,deg,177,plusmn,178,sup2,179,sup3,180,acute,181,micro,182,para,183,middot,184,cedil,185,sup1,186,ordm,187,raquo,188,frac14,189,frac12,190,frac34,191,iquest,192,Agrave,193,Aacute,194,Acirc,195,Atilde,196,Auml,197,Aring,198,AElig,199,Ccedil,200,Egrave,201,Eacute,202,Ecirc,203,Euml,204,Igrave,205,Iacute,206,Icirc,207,Iuml,208,ETH,209,Ntilde,210,Ograve,211,Oacute,212,Ocirc,213,Otilde,214,Ouml,215,times,216,Oslash,217,Ugrave,218,Uacute,219,Ucirc,220,Uuml,221,Yacute,222,THORN,223,szlig,224,agrave,225,aacute,226,acirc,227,atilde,228,auml,229,aring,230,aelig,231,ccedil,232,egrave,233,eacute,234,ecirc,235,euml,236,igrave,237,iacute,238,icirc,239,iuml,240,eth,241,ntilde,242,ograve,243,oacute,244,ocirc,245,otilde,246,ouml,247,divide,248,oslash,249,ugrave,250,uacute,251,ucirc,252,uuml,253,yacute,254,thorn,255,yuml,402,fnof,913,Alpha,914,Beta,915,Gamma,916,Delta,917,Epsilon,918,Zeta,919,Eta,920,Theta,921,Iota,922,Kappa,923,Lambda,924,Mu,925,Nu,926,Xi,927,Omicron,928,Pi,929,Rho,931,Sigma,932,Tau,933,Upsilon,934,Phi,935,Chi,936,Psi,937,Omega,945,alpha,946,beta,947,gamma,948,delta,949,epsilon,950,zeta,951,eta,952,theta,953,iota,954,kappa,955,lambda,956,mu,957,nu,958,xi,959,omicron,960,pi,961,rho,962,sigmaf,963,sigma,964,tau,965,upsilon,966,phi,967,chi,968,psi,969,omega,977,thetasym,978,upsih,982,piv,8226,bull,8230,hellip,8242,prime,8243,Prime,8254,oline,8260,frasl,8472,weierp,8465,image,8476,real,8482,trade,8501,alefsym,8592,larr,8593,uarr,8594,rarr,8595,darr,8596,harr,8629,crarr,8656,lArr,8657,uArr,8658,rArr,8659,dArr,8660,hArr,8704,forall,8706,part,8707,exist,8709,empty,8711,nabla,8712,isin,8713,notin,8715,ni,8719,prod,8721,sum,8722,minus,8727,lowast,8730,radic,8733,prop,8734,infin,8736,ang,8743,and,8744,or,8745,cap,8746,cup,8747,int,8756,there4,8764,sim,8773,cong,8776,asymp,8800,ne,8801,equiv,8804,le,8805,ge,8834,sub,8835,sup,8836,nsub,8838,sube,8839,supe,8853,oplus,8855,otimes,8869,perp,8901,sdot,8968,lceil,8969,rceil,8970,lfloor,8971,rfloor,9001,lang,9002,rang,9674,loz,9824,spades,9827,clubs,9829,hearts,9830,diams,338,OElig,339,oelig,352,Scaron,353,scaron,376,Yuml,710,circ,732,tilde,8194,ensp,8195,emsp,8201,thinsp,8204,zwnj,8205,zwj,8206,lrm,8207,rlm,8211,ndash,8212,mdash,8216,lsquo,8217,rsquo,8218,sbquo,8220,ldquo,8221,rdquo,8222,bdquo,8224,dagger,8225,Dagger,8240,permil,8249,lsaquo,8250,rsaquo,8364,euro"),c=h.split(",");for(f=0;f<c.length;f+=2)e[String.fromCharCode(c[f])]=c[f+1],g=parseInt(c[f]).toString(16),d+="\\u"+"0000".substring(g.length)+g;d=new RegExp("["+d+"]","g"),a.onGetContent.add(function(a,b){b.format=="html"&&(b.content=b.content.replace(d,function(a){var b;if(b=e[a])a="&"+b+";";return a}))})}}(punymce),function(a){a.plugins.ForceBlocks=function(b){function m(){d=b.dom,c.add(b.getDoc(),"keyup",p),b.onSetContent.add(p),b.onBeforeGetContent.add(p),f||(b.onPreProcess.add(function(a,b){j(b.node.getElementsByTagName("br"),function(b){var c=b.parentNode;c&&c.nodeName=="p"&&(c.childNodes.length==1||c.lastChild==b)&&c.replaceChild(a.getDoc().createTextNode(" "),b)})}),c.add(b.getDoc(),"keypress",function(a){if(a.keyCode==13&&!a.shiftKey&&!t(a))return c.cancel(a)}),g&&c.add(b.getDoc(),"keydown",function(a){(a.keyCode==8||a.keyCode==46)&&!a.shiftKey&&u(a,a.keyCode==8)}))}function n(a){var b,c;return b=a.document,c=b.compatMode=="CSS1Compat"?b.documentElement:b.body,{x:a.pageXOffset||c.scrollLeft,y:a.pageYOffset||c.scrollTop,w:a.innerWidth||c.clientWidth,h:a.innerHeight||c.clientHeight}}function o(a,c,d){var e=b.getDoc().createTreeWalker(a,4,null,!1),a,f=-1;while(a=e.nextNode()){f++;if(c==0&&a==d)return f;if(c==1&&f==d)return a}return-1}function p(){var a=this,c=b.getBody(),d=b.getDoc(),e=b.selection,g=e.getSel(),h=e.getRng(),i=-2,j,k,m,n,p=-16777215,r,s,t,u,v,w=c.childNodes,x,y,z;for(x=w.length-1;x>=0;x--){r=w[x];if(r.nodeType==3||!q(r)&&r.nodeType!=8)if(!s){if(r.nodeType!=3||/[^\s]/g.test(r.nodeValue))i==-2&&h&&(f?(n=d.body.createTextRange(),n.moveToElementText(c),n.collapse(1),t=n.move("character",p)*-1,n=h.duplicate(),n.collapse(1),u=n.move("character",p)*-1,n=h.duplicate(),n.collapse(0),v=n.move("character",p)*-1-u,i=u-t,j=v):h.startContainer.nodeType==1&&(y=h.startContainer.childNodes[h.startOffset])&&y.nodeType==1?(z=y.getAttribute("id"),y.setAttribute("id","__mce")):b.dom.getParent(h.startContainer,function(a){return a===c})&&(k=h.startOffset,m=h.endOffset,i=o(c,0,h.startContainer),j=o(c,0,h.endContainer))),s=b.dom.create(l.element),s.appendChild(r.cloneNode(1)),r.parentNode.replaceChild(s,r)}else s.hasChildNodes()?s.insertBefore(r,s.firstChild):s.appendChild(r);else s=null}if(i!=-2)if(!f)s=c.getElementsByTagName(l.element)[0],h=d.createRange(),i!=-1?h.setStart(o(c,1,i),k):h.setStart(s,0),j!=-1?h.setEnd(o(c,1,j),m):h.setEnd(s,0),g&&(g.removeAllRanges(),g.addRange(h));else try{h=g.createRange(),h.moveToElementText(c),h.collapse(1),h.moveStart("character",i),h.moveEnd("character",j),h.select()}catch(A){}else!f&&(y=b.dom.get("__mce"))&&(z?y.setAttribute("id",z):y.removeAttribute("id"),h=d.createRange(),h.setStartBefore(y),h.setEndBefore(y),e.setRng(h))}function q(a){return a.nodeType==1&&/^(H[1-6]|P|DIV|ADDRESS|PRE|FORM|TABLE|LI|OL|UL|TD|CODE|CAPTION|BLOCKQUOTE|CENTER|DL|DT|DD|DIR|FIELDSET|NOSCRIPT|NOFRAMES|MENU|ISINDEX|SAMP)$/.test(a.nodeName)}function r(a){return d.getParent(a,function(a){return q(a)})}function s(a){return a=a.innerHTML,a=a.replace(/<img|hr|table/g,"d"),a=a.replace(/<[^>]+>/g,""),a.replace(/[ \t\r\n]+/g,"")==""}function t(c){var e=b.getDoc(),f=b.selection.getSel(),g=b.selection.getRng(),i=e.body,j,k,m,o,p,t,u,v,y,z,A,B,C,D,E,F,G;if(a.isOldWebKit)return!0;j=e.createRange(),j.setStart(f.anchorNode,f.anchorOffset),j.collapse(!0),k=e.createRange(),k.setStart(f.focusNode,f.focusOffset),k.collapse(!0),m=j.compareBoundaryPoints(j.START_TO_END,k)<0,o=m?f.anchorNode:f.focusNode,p=m?f.anchorOffset:f.focusOffset,t=m?f.focusNode:f.anchorNode,u=m?f.focusOffset:f.anchorOffset,o=o.nodeName=="BODY"?o.firstChild:o,t=t.nodeName=="BODY"?t.firstChild:t,v=r(o),y=r(t),z=v?v.nodeName:l.element;if(d.getParent(v,function(a){return/OL|UL/.test(a.nodeName)}))return!0
;v&&(v.nodeName=="CAPTION"||/absolute|relative|static/gi.test(v.style.position))&&(z=l.element,v=null),y&&(y.nodeName=="CAPTION"||/absolute|relative|static/gi.test(y.style.position))&&(z=l.element,y=null);if(/(TD|TABLE|TH|CAPTION)/.test(z)||v&&z=="DIV"&&/left|right/gi.test(v.style.cssFloat))z=l.element,v=y=null;A=v&&v.nodeName==z?v.cloneNode(0):e.createElement(z),B=y&&y.nodeName==z?y.cloneNode(0):e.createElement(z),B.id="",/^(H[1-6])$/.test(z)&&o.nodeValue&&p==o.nodeValue.length&&(B=e.createElement(l.element)),E=C=o;do{if(E==i||E.nodeType==9||q(E)||/(TD|TABLE|TH|CAPTION)/.test(E.nodeName))break;C=E}while(E=E.previousSibling?E.previousSibling:E.parentNode);E=D=t;do{if(E==i||E.nodeType==9||q(E)||/(TD|TABLE|TH|CAPTION)/.test(E.nodeName))break;D=E}while(E=E.nextSibling?E.nextSibling:E.parentNode);return C.nodeName==z?j.setStart(C,0):j.setStartBefore(C),j.setEnd(o,p),A.appendChild(j.cloneContents()),k.setEndAfter(D),k.setStart(t,u),B.appendChild(k.cloneContents()),g=e.createRange(),!C.previousSibling&&C.parentNode.nodeName==z?g.setStartBefore(C.parentNode):j.startContainer.nodeName==z&&j.startOffset==0?g.setStartBefore(j.startContainer):g.setStart(j.startContainer,j.startOffset),!D.nextSibling&&D.parentNode.nodeName==z?g.setEndAfter(D.parentNode):g.setEnd(k.endContainer,k.endOffset),g.deleteContents(),A.firstChild&&A.firstChild.nodeName==z&&(A.innerHTML=A.firstChild.innerHTML),B.firstChild&&B.firstChild.nodeName==z&&(B.innerHTML=B.firstChild.innerHTML),s(A)&&(A.innerHTML=h?" <br />":"<br />"),s(B)&&(B.innerHTML=h?" <br />":"<br />"),h?(g.insertNode(A),g.insertNode(B)):(g.insertNode(B),g.insertNode(A)),B.normalize(),A.normalize(),g=e.createRange(),g.selectNodeContents(B),g.collapse(1),f.removeAllRanges(),f.addRange(g),vp=n(b.getWin()),F=b.dom.getPos(B).y,G=B.clientHeight,(F<vp.y||F+G>vp.y+vp.h)&&b.getWin().scrollTo(0,F<vp.y?F:F-vp.h+25),!1}function u(a,d){function l(a){var b;a=a.target;if(a&&a.parentNode&&a.nodeName=="BR"&&(f=r(a))){b=a.previousSibling,c.remove(e,"DOMNodeInserted",l);if(b&&b.nodeType==3&&/\s+$/.test(b.nodeValue))return;(a.previousSibling||a.nextSibling)&&a.parentNode.removeChild(a)}}var e=b.getBody(),f,g=b.selection,h=g.getRng(),i=h.startContainer,f,j,k;if(i&&q(i)&&!/^(TD|TH)$/.test(i.nodeName)&&d)if(i.childNodes.length==0||i.childNodes.length==1&&i.firstChild.nodeName=="BR"){f=i;while((f=f.previousSibling)&&!q(f));if(f){if(i!=e.firstChild){j=b.getDoc().createTreeWalker(f,NodeFilter.SHOW_TEXT,null,!1);while(k=j.nextNode())f=k;h=b.getDoc().createRange(),h.setStart(f,f.nodeValue?f.nodeValue.length:0),h.setEnd(f,f.nodeValue?f.nodeValue.length:0),g.getSel().removeAllRanges(),g.getSel().addRange(h),i.parentNode.removeChild(i)}return c.cancel(a)}}c._add(e,"DOMNodeInserted",l),window.setTimeout(function(){c._remove(e,"DOMNodeInserted",l)},1)}var c=a.Event,d,e=this,f,g,h,i,j,k,l;f=a.isIE,g=a.isGecko,h=a.isOpera,i=a.isWebKit,j=a.each,k=a.extend,this.settings=l=k({element:"P"},b.settings.forceblocks),b.onPreInit.add(m,e),f||b.onSetContent.add(function(a,b){b.format=="html"&&(b.content=b.content.replace(/<p>[\s\u00a0]+<\/p>/g,"<p><br /></p>"))}),b.onPostProcess.add(function(a,b){b.content=b.content.replace(/<p><\/p>/g,"<p> </p>")})}}(punymce),punymce.plugins.ForceNL=function(a){a.onGetContent.add(function(a,b){(b.format=="forcenl"||b.save)&&punymce.each([[/<(br\s*\/)>/gi,"\n"],[/<(br.*?\/)>/gi,""]],function(a){b.content=b.content.replace(a[0],a[1])})}),a.onSetContent.add(function(a,b){(b.format=="forcenl"||b.load)&&punymce.each([[/\n/gi,"<br />"]],function(a){b.content=b.content.replace(a[0],a[1])})})},function(a){a.plugins.Image=function(b){var c=a.I18n;(!b.settings.image||b.settings.image.skip_css)&&a.DOM.loadCSS(a.baseURL+"/plugins/image/css/editor.css"),a.extend(b.commands,{mceInsertImage:function(a,e,f){var g,h=b.selection.getNode();g=prompt(c.entersrc,h.nodeName=="IMG"?b.dom.getAttr(h,"src"):""),g&&b.selection.setNode(b.dom.create("img",{src:g}))}}),a.extend(b.tools,{image:{cmd:"mceInsertImage",title:c.insertimage}})},a.extend(a.I18n,{insertimage:"Insert image",entersrc:"Enter the URL of the image"})}(punymce),function(a){a.plugins.Link=function(b){var c=a.I18n;(!b.settings.link||b.settings.link.skip_css)&&a.DOM.loadCSS(a.baseURL+"/plugins/link/css/editor.css"),a.extend(b.commands,{mceInsertLink:function(a,e,f){var g,h=b.selection.getNode();g=prompt(c.enterhref,h.nodeName=="A"?b.dom.getAttr(h,"href"):""),g&&(b.selection.isCollapsed()?b.selection.setContent('<a href="'+g+'">'+g+"</a>"):b.execCommand("CreateLink",0,g))}}),a.extend(b.tools,{link:{cmd:"mceInsertLink",title:c.link},unlink:{cmd:"Unlink",title:c.unlink}})},a.extend(a.I18n,{link:"Insert link",unlink:"Unlink",enterhref:"Enter the URL of the link"})}(punymce),function(a){function c(a,b){var c,d;return c=b.parentNode,d=b.nextSibling,d?c.insertBefore(a,d):c.appendChild(a),a}function d(a,b,c){var d,e=a.getDoc().createTreeWalker(b,NodeFilter.SHOW_TEXT,null,!1);if(c)return e.nextNode();while(d=e.nextNode())b=d;return b}var b=a.Event;a.plugins.Paste=function(c){function f(b){var d,f=[],g,i,j=c.selection,k,l,m,n,o;c.getWin().focus(),e&&(r=c.selection.getRng(),r.moveToBookmark(e),r.select()),d=b.split(/\r?\n/);if(d.length>1){b="",a.each(d,function(a){b+="<p>"+a+"</p>"});if(!a.isIE){c.execCommand("Delete"),j.setContent('<span id="marker"></span>'),g=c.dom.getParent(c.dom.get("marker").parentNode,function(a){f.push(a);if(/^(p|h[1-6]|div)$/i.test(a.nodeName))return!0});if(g){c.onPaste.dispatch({text:b}),k=l="";for(m=0;m<f.length;m++)k+="</"+f[m].nodeName.toLowerCase()+">";for(m=f.length-1;m>=0;m--)l+="<"+f[m].nodeName.toLowerCase()+">";b=k+b+l+'<span id="_caret">&nbsp;</span>',c.getBody().innerHTML=c.getBody().innerHTML.replace(/<span id=\"marker\"><\/span>/gi,b),i=c.dom.get("_caret"),a.isGecko||i.scrollIntoView(),n=c.getDoc().createRange(),n.setStartBefore(i),n.setEndAfter(i),j.setRng(n),c.execCommand("Delete");return}o=c.dom.get("marker"),o.parentNode.removeChild(o)}}c.selection.setContent(b),c.onPaste.dispatch({text:b})}function g(a){var b,d,e=c.selection,g=e.getSel(),h,j=c.getBody();b=c.dom.add(j,"div",{id:"_mcePaste",style:"position:absolute;left:-10000px;top:"+j.scrollTop},"&nbsp;"),h=e.getRng(),b=b.firstChild,d=c.getDoc().createRange(),d.setStart(b,0),d.setEnd(b,1),g.removeAllRanges(),g.addRange(d),window.setTimeout(function(){var a=c.dom.get("_mcePaste"),b;b=a.innerHTML,a.parentNode.removeChild(a),h&&e.setRng(h),f(b.replace(/[\r\n]/g,"").replace(/<(\/p|br\s*\/?)>/g,"\n").replace(/<!--.*?-->/g,"").replace(/<[^>]+>/g,""))},0)}var d=a.DOM,e;c.onPaste=new a.Dispatcher(c),c.onInit.add(function(){if(a.isOpera)return;/Firefox\/2/.test(navigator.userAgent)?b.add(c.getDoc(),"keydown",function(b){if((b.metaKey||b.ctrlKey)&&b.keyCode==86||b.shiftKey&&b.keyCode==45)a.isIE&&(e=c.selection.getRng().getBookmark()),g(b)},this):b.add(a.isIE?c.getBody():c.getDoc(),"paste",function(a){var d;if(c.getWin().clipboardData)return f(c.getWin().clipboardData.getData("Text")),b.cancel(a);if(a.clipboardData)return f(a.clipboardData.getData("text/plain")),b.cancel(a);g(a)})})}}(punymce),function(a){a.plugins.Protect=function(b){var c=[],d,e;e=b.settings.protect||{},e.list||(e.list=[/<(script|noscript|style)[\u0000-\uFFFF]*?<\/(script|noscript|style)>/g]),b.onSetContent.add(function(b,d){a.each(e.list,function(a){d.content=d.content.replace(a,function(a){return c.push(a),"<!-- pro:"+(c.length-1)+" -->"})})}),b.onGetContent.add(function(a,b){b.content=b.content.replace(/<!-- pro:([0-9]+) -->/g,function(a,b){return c[parseInt(b)]})})}}(punymce),function(a){a.plugins.Safari2x=function(c){function i(a,b){var e=c.getDoc(),f,g;b=b||{},e.execCommand("FontName",!1,"_tmp"),d(c.dom.select("span"),function(c){c.style.fontFamily=="_tmp"&&(f=l(c,a,b),g||(g=f))}),f=f.firstChild,c.selection.getSel().setBaseAndExtent(g,0,f,f.nodeValue.length)}function j(a){var b=c.selection,d;b.setContent("<"+a+'><li id="_tmp"></li></'+a+">"),d=c.dom.get("_tmp"),d.id="",b.select(d),b.collapse(1)}function k(a){return c.dom.getParent(a,function(a){return/^(H[1-6]|P|DIV|ADDRESS|PRE|FORM|TABLE|LI|OL|UL|TD|CODE|CAPTION|BLOCKQUOTE|CENTER|DL|DT|DD|DIR|FIELDSET|NOSCRIPT|NOFRAMES|MENU|ISINDEX|SAMP)$/.test(a.nodeName)})}function l(a,b,e){var f=c.getDoc(),g;return e=e||{},g=f.createElement(b),d(a.attributes,function(a){a.specified&&a.nodeValue&&g.setAttribute(a.nodeName,a.nodeValue)}),d(e,function(a,b){g.setAttribute(b,a)}),d(a.childNodes,function(a){g.appendChild(a.cloneNode(!0))}),a.parentNode.replaceChild(g,a),g}var d=a.each,e=a.Event,f,g,h;if(!a.isOldWebKit)return;c.selection.getRng=function(){var a=this,b=a.getSel(),d=c.getDoc(),e,f,g,h;if(b.anchorNode){e=d.createRange();try{f=d.createRange(),f.setStart(b.anchorNode,b.anchorOffset),f.collapse(1),g=d.createRange(),g.setStart(b.focusNode,b.focusOffset),g.collapse(1),h=f.compareBoundaryPoints(f.START_TO_END,g)<0,e.setStart(h?b.anchorNode:b.focusNode,h?b.anchorOffset:b.focusOffset),e.setEnd(h?b.focusNode:b.anchorNode,h?b.focusOffset:b.anchorOffset)}catch(i){}}return e},g=c.selection.setContent,c.selection.setContent=function(a,e){var f=this.getRng();try{g.call(this,a,e)}catch(h){b=c.dom.create("body"),b.innerHTML=a,d(b.childNodes,function(a){f.insertNode(a.cloneNode(!0))})}},h=c.selection.collapse,c.selection.collapse=function(a){try{h.call(this,a)}catch(b){}},c.onInit.add(function(){a.DOM.get(c.settings.id+"_r").style.display="none"}),c.onPreInit.add(function(){e.add(c.getDoc(),"click",function(a){if(a.target.nodeName=="A")return c.selection.select(a.target),e.cancel(a)}),e.add(c.getDoc(),"keydown",function(a){var b=c.selection,d,f,g,h;if(a.charCode>32||a.keyCode==13){d=c.dom.getParent(b.getNode(),function(a){return a.nodeName=="LI"});if(d){f=b.getRng().startOffset;if(a.keyCode!=13){h=String.fromCharCode(a.charCode);if(!/^\w$/.test(h))return;return b.setContent(h),g=b.getRng(),b=b.getSel(),d=b.anchorNode,d.nodeName=="LI"?b.setBaseAndExtent(d,1,d,1):(d=d.nextSibling,b.setBaseAndExtent(d,1,d,1)),e.cancel(a)}if(!d.hasChildNodes()){if(!d.nextSibling||d.nextSibling.nodeName!="LI"){g=c.dom.getParent(b.getNode(),function(a){return/(UL|OL)/.test(a.nodeName)}),d.parentNode.removeChild(d),b.select(g.nextSibling);return}return e.cancel(a)}h=c.getDoc().createTextNode(" "),d.appendChild(h),window.setTimeout(function(){var a=b.getNode();a.firstChild&&a.firstChild.nodeValue.charAt(0)==" "&&(a.removeChild(a.firstChild),b.select(a))},1)}}})}),a.extend(c.commands,{IncreaseFontSize:function(){var a=c.getDoc(),b=parseInt(a.queryCommandValue("FontSize"));a.execCommand("FontSize",!1,b+1+"px")},DecreaseFontSize:function(){var a=c.getDoc(),b=parseInt(a.queryCommandValue("FontSize"));b>0&&a.execCommand("FontSize",!1,b-1+"px")},Strikethrough:function(){i("strike")},CreateLink:function(a,b){i("a",{href:b,mce_href:b})},Unlink:function(){var a=c.selection;a.setContent(a.getContent().replace(/(<a[^>]+>|<\/a>)/,""))},RemoveFormat:function(){var a=c.selection;a.setContent(a.getContent().replace(/(<(span|b|i|strong|em|strike) [^>]+>|<(span|b|i|strong|em|strike)>|<\/(span|b|i|strong|em|strike)>|)/g,""))},FormatBlock:function(a,b){var d=c.selection,e;e=k(c.selection.getNode()),e&&(r=l(e,b.replace(/<|>/g,""))),d.select(r),d.collapse(1)},InsertUnorderedList:function(){j("ul")},InsertOrderedList:function(){j("ol")},Indent:function(){var a=k(c.selection.getNode()),b;a&&(b=parseInt(a.style.paddingLeft)||0,a.style.paddingLeft=b+10+"px")},Outdent:function(){var a=k(c.selection.getNode()),b;a&&(b=parseInt(a.style.paddingLeft)||0,b>=10&&(a.style.paddingLeft=b-10+"px"))}})}}(punymce),function(a){function b(a,b){var c,d;return c=b.parentNode,d=b.nextSibling,d?c.insertBefore(a,d):c.appendChild(a),a}a.plugins.TabFocus=function(d){var e=a.Event,f=a.DOM;d.onInit.add(function(){var a,g,h;h=b(f.create("a",{href:"#"}),f.get(d.settings.id+"_c")),e.add(h,"focus",function(a){d.getWin().focus()}),e.add(d.getDoc(),"keydown",function(a){if(a.keyCode==9)return e.cancel(a)}),e.add(d.getDoc(),"keydown",function(a){a.keyCode==9&&(window.focus(),f.get(d.settings.tabfocus_id).focus())})})}}(punymce),function(a){a.plugins.TextColor=function(b){var c="000000,993300,333300,003300,003366,000080,333399,333333,800000,FF6600,808000,008000,008080,0000FF,666699,808080,FF0000,FF9900,99CC00,339966,33CCCC,3366FF,800080,999999,FF00FF,FFCC00,FFFF00,00FF00,00FFFF,00CCFF,993366,C0C0C0,FF99CC,FFCC99,FFFF99,CCFFCC,CCFFFF,99CCFF,CC99FF,FFFFFF",d=a.DOM,e=a.Event,f=a.each,g=a.extend,h;(!b.settings.textcolor||b.settings.textcolor.skip_css)&&d.loadCSS(a.baseURL+"/plugins/textcolor/css/editor.css"),h=g({colors:c},b.settings.textcolor),g(b.commands,{mceColor:function(a,c,g){function o(a){return b.hideMenu=null,e.remove(document,"click",o),e.remove(b.getDoc(),"click",o),d.get(k+"_mcolor").style.display="none",1}var i,j=this,k=b.settings.id,l=d.getPos(g.target),m,n;if(b.hideMenu)return b.hideMenu();i=d.get(k+"_mcolor"),i||(i=d.get(k+"_t"),i=d.add(document.body,"div",{id:k+"_mcolor","class":"punymce_color punymce"}),i=d.add(i,"table",{"class":"punymce"}),i=d.add(i,"tbody"),m=8,f(h.colors.split(","),function(a){m==8&&(r=d.add(i,"tr"),m=0),m++,e.add(d.add(d.add(r,"td"),"a",{href:"#",style:"background:#"+a}),"mousedown",function(c){return o.call(j),b.execCommand("forecolor",0,"#"+a),e.cancel(c)})})),e.add(document,"click",o,j),e.add(b.getDoc(),"click",o,j),b.hideMenu=o,h=d.get(k+"_mcolor").style,h.left=l.x+"px",h.top=l.y+g.target.clientHeight+2+"px",h.display="block"}}),g(b.tools,{textcolor:{cmd:"mceColor",title:a.I18n.textcolor}})},a.extend(a.I18n,{textcolor:"Text color"})}(punymce);